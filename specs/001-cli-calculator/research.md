# Research: CLI計算機

**Feature**: CLI計算機  
**Date**: 2025-10-23  
**Purpose**: Technical decisions and best practices research for Java 25 CLI application

## Technical Decisions

### Java 25の使用

**Decision**: Java 25を主要開発言語として使用

**Rationale**: 
- 仕様書で明確に指定されている
- 最新のJavaバージョンで、高いパフォーマンスと新機能を提供
- エンタープライズレベルの安定性とセキュリティ
- 豊富なツールサポートとエコシステム

**Alternatives considered**: 
- Java 21 LTS: 安定性は高いが、仕様書の要求がJava 25
- Java 17 LTS: より安定だが、新機能の欠如
- Kotlin: JVM上で動作するが、追加の複雑性を導入

### Gradle 8.xの使用

**Decision**: Gradle 8.x以上をビルドツールとして使用

**Rationale**:
- 仕様書で指定されている
- Java 25との優れた互換性
- アプリケーションプラグインによる実行可能JAR生成のサポート
- 高速なビルドパフォーマンスと増分ビルド
- 豊富なプラグインエコシステム

**Alternatives considered**:
- Maven: 成熟しているが、Gradleより設定が冗長
- SBT: Scalaプロジェクト向けで、Javaプロジェクトには過剰

### テストフレームワーク

**Decision**: JUnit 5 (Jupiter)を単体テストフレームワークとして使用

**Rationale**:
- Java開発のデファクトスタンダード
- Java 25との完全な互換性
- モダンなアノテーションベースの記法
- パラメータ化テストや動的テストのサポート
- Gradleとの優れた統合

**Alternatives considered**:
- TestNG: 高機能だが、JUnit 5で十分
- Spock: Groovy依存で追加の複雑性

### アーキテクチャパターン

**Decision**: レイヤード・アーキテクチャ（簡略版）を採用

**Rationale**:
- 責任の明確な分離
- テストが容易
- 保守性が高い
- 小規模プロジェクトに適したシンプルさ

**Alternatives considered**:
- MVC: Web向けパターンでCLIには不適切
- ヘキサゴナル: 小規模プロジェクトには過剰
- モノリシック: 保守性とテスト性が低い

### エラーハンドリング戦略

**Decision**: カスタム例外クラスと集中化されたエラーハンドラーを使用

**Rationale**:
- エラーメッセージの一貫性
- 国際化対応の準備
- デバッグとログの改善
- ユーザーエクスペリエンスの向上

**Alternatives considered**:
- 標準例外のみ: ユーザーフレンドリーでない
- エラーコード: 現代的でない手法

## Best Practices

### Java 25のベストプラクティス

1. **レコードクラスの活用**: データ転送オブジェクトとしてレコードを使用
2. **スイッチ式**: パターンマッチングを活用した演算子処理
3. **テキストブロック**: ヘルプメッセージの可読性向上
4. **モジュールシステム**: 必要に応じてJigsawモジュールを検討

### CLIアプリケーションのベストプラクティス

1. **コマンドライン引数の検証**: 早期失敗戦略
2. **標準ストリームの適切な使用**: stdout（結果）、stderr（エラー）
3. **終了コード**: 0（成功）、1（エラー）の適切な使用
4. **ヘルプとバージョン情報**: --help、--versionの標準的な実装

### テストのベストプラクティス

1. **TDD（テスト駆動開発）**: レッド・グリーン・リファクタサイクル
2. **テストの命名**: shouldReturnExpectedResultWhenValidInput形式
3. **テストの分離**: 各テストは独立して実行可能
4. **境界値テスト**: 最大値、最小値、エッジケースをテスト

### パフォーマンスのベストプラクティス

1. **BigDecimalの使用**: 正確な小数点計算のため
2. **String Builderの活用**: 文字列連結のパフォーマンス向上
3. **例外処理のオーバーヘッド**: ホットパスでの例外使用を避ける
4. **JVMの起動時間最適化**: --XX:TieredStopAtLevel=1などの検討

## Implementation Guidelines

### コード構成

- パッケージは機能別に分離（operation、validation、util）
- 単一責任の原則を厳格に適用
- インターフェースを使用した依存関係の抽象化
- ファクトリーパターンで演算オブジェクトの生成を管理

### セキュリティ考慮事項

- 入力値の厳格な検証
- 数値オーバーフローの検出と処理
- スタックオーバーフローの防止
- セキュリティに関連する設定情報の適切な管理

### 保守性

- 包括的なJavaDocコメント
- 意味のある変数名とメソッド名
- 設定の外部化（version.properties）
- ログ出力の一貫性

### ビルドと配布

- Gradleラッパーの使用でビルド環境の統一
- Fat JARの生成で依存関係の単一化
- バージョン管理の自動化
- CI/CDパイプラインとの統合準備
