# 機能仕様書: CLI計算機

**Feature Branch**: `001-cli-calculator`  
**Created**: 2025-10-23  
**Status**: Draft  
**Input**: User description: "CLI上で四則演算を行う計算機アプリを作成したいです。"

## ユーザーシナリオ & テスト *(必須)*

<!--
  重要: ユーザーストーリーは重要度順に優先度付けされたユーザージャーニーとして記述する必要があります。
  各ユーザーストーリー/ジャーニーは独立してテスト可能でなければならず、つまり1つだけを実装しても
  価値を提供するMVP（Minimum Viable Product）を持つべきです。
  
  各ストーリーに優先度（P1、P2、P3など）を割り当て、P1が最も重要です。
  各ストーリーを以下が可能な独立した機能のスライスとして考えてください：
  - 独立した開発
  - 独立したテスト
  - 独立したデプロイ
  - ユーザーへの独立したデモンストレーション
-->

### ユーザーストーリー 1 - 基本四則演算の実行 (優先度: P1)

ユーザーがコマンドラインで数値と演算子を入力し、加算、減算、乗算、除算の結果を即座に取得する。

**この優先度の理由**: 計算機の最も基本的な機能であり、これがなければアプリの価値がない。単純な計算でも業務効率化に直結する。

**独立テスト**: 「calculator 5 + 3」のようなコマンド実行で「8」という結果が返されることを確認し、基本的な計算機能の価値を提供する。

**受け入れシナリオ**:

1. **Given** ユーザーがCLIを開いている、**When** "calculator 10 + 5" を実行する、**Then** "15" が表示される
2. **Given** ユーザーがCLIを開いている、**When** "calculator 20 - 8" を実行する、**Then** "12" が表示される
3. **Given** ユーザーがCLIを開いている、**When** "calculator 6 * 7" を実行する、**Then** "42" が表示される
4. **Given** ユーザーがCLIを開いている、**When** "calculator 15 / 3" を実行する、**Then** "5" が表示される

---

### ユーザーストーリー 2 - エラーハンドリング (優先度: P2)

ユーザーが不正な入力を行った場合に、わかりやすいエラーメッセージを表示し、正しい使用方法を案内する。

**この優先度の理由**: 実用的なツールとして使用するためには、エラー時の適切な対応が必要。ユーザーの学習コストを下げる。

**独立テスト**: 「calculator abc + 5」のような不正入力で適切なエラーメッセージが表示され、ユーザーが正しい使用方法を理解できる。

**受け入れシナリオ**:

1. **Given** ユーザーがCLIを開いている、**When** "calculator abc + 5" を実行する、**Then** "エラー: 数値ではありません" というメッセージが表示される
2. **Given** ユーザーがCLIを開いている、**When** "calculator 10 $ 5" を実行する、**Then** "エラー: サポートされていない演算子です" というメッセージが表示される
3. **Given** ユーザーがCLIを開いている、**When** "calculator 10 / 0" を実行する、**Then** "エラー: ゼロで除算することはできません" というメッセージが表示される

---

### ユーザーストーリー 3 - ヘルプとバージョン情報 (優先度: P3)

ユーザーがヘルプオプションを使用して使用方法を確認し、バージョン情報を取得できる。

**この優先度の理由**: ツールの使いやすさと保守性を向上させる。新規ユーザーの学習を支援し、サポート時にバージョン確認が可能。

**独立テスト**: 「calculator --help」で使用方法が表示され、「calculator --version」でバージョン情報が表示される。

**受け入れシナリオ**:

1. **Given** ユーザーがCLIを開いている、**When** "calculator --help" を実行する、**Then** 使用方法とオプションの説明が表示される
2. **Given** ユーザーがCLIを開いている、**When** "calculator --version" を実行する、**Then** アプリのバージョン番号が表示される

---

### エッジケース

- 非常に大きな数値（整数の最大値を超える場合）はどうなるか？
- 小数点を含む計算結果の精度はどう処理するか？
- 引数なしでコマンドを実行した場合はどうなるか？
- 複数の演算子が含まれる場合（例: "5 + 3 * 2"）はどう処理するか？

## 要件 *(必須)*

<!--
  アクション必須: このセクションの内容はプレースホルダーです。
  適切な機能要件を記入してください。
-->

### 機能要件

- **FR-001**: システムは整数の加算、減算、乗算、除算を実行できなければならない
- **FR-002**: システムは小数を含む数値の計算をサポートしなければならない
- **FR-003**: ユーザーはコマンドライン引数として「数値 演算子 数値」の形式で入力できなければならない
- **FR-004**: システムは計算結果を標準出力に表示しなければならない
- **FR-005**: システムは不正な入力に対して適切なエラーメッセージを標準エラー出力に表示しなければならない
- **FR-006**: システムはゼロ除算エラーを検出し、適切なエラーメッセージを表示しなければならない
- **FR-007**: システムは--helpオプションで使用方法を表示しなければならない
- **FR-008**: システムは--versionオプションでバージョン情報を表示しなければならない

### 主要エンティティ *(機能にデータが関わる場合に含める)*

- **計算式**: 2つの数値と1つの演算子から構成される数学的表現
- **演算子**: +（加算）、-（減算）、*（乗算）、/（除算）の4つの基本算術演算子
- **数値**: 整数または小数点数として表現される計算の入力値と結果値

## 成功基準 *(必須)*

<!--
  アクション必須: 測定可能な成功基準を定義してください。
  これらは技術に依存せず、測定可能でなければなりません。
-->

### 測定可能な成果

- **SC-001**: ユーザーは基本的な計算（例: 5 + 3）を1秒以内に実行し結果を取得できる
- **SC-002**: システムは不正な入力に対して100%の確率で適切なエラーメッセージを表示する
- **SC-003**: 新規ユーザーがヘルプドキュメントを参照せずに基本的な計算を90%以上の確率で成功させる
- **SC-004**: システムは最大15桁の数値まで正確な計算結果を提供する
- **SC-005**: コマンドの実行から結果表示まで100ミリ秒以内で完了する
- **SC-006**: エラー発生時にユーザーが問題を理解し修正方法を把握できる（エラーメッセージの明確性）

## 技術要件 *(必須)*

### 開発環境要件
- **Java**: Java 25を使用する
- **ビルドツール**: Gradle 8.x以上を使用する
- **パッケージング**: 実行可能JARファイルとして配布可能であること
- **実行要件**: Java 25がインストールされた環境で動作すること

### 非機能要件
- **NFR-001**: アプリケーションはスタンドアロンで実行可能でなければならない（外部依存関係なし）
- **NFR-002**: ビルド成果物は単一の実行可能JARファイルでなければならない
- **NFR-003**: メモリ使用量は128MB以下でなければならない
- **NFR-004**: アプリケーション起動時間は500ミリ秒以下でなければならない
- **NFR-005**: テストカバレッジは90%以上でなければならない

### ビルド・配布要件
- **BR-001**: Gradleタスク `./gradlew build` でビルドが完了すること
- **BR-002**: Gradleタスク `./gradlew test` でテストが実行できること
- **BR-003**: Gradleタスク `./gradlew run --args="10 + 5"` で実行できること
- **BR-004**: `java -jar calculator.jar 10 + 5` で実行できること

## 前提と制約

### 前提条件
- ユーザーは基本的なコマンドライン操作ができる
- Java 25がシステムにインストールされている
- 計算対象は基本的な算術演算（四則演算）に限定される
- 単一の計算式（2つの数値と1つの演算子）を扱う

### 制約事項
- 複雑な数式（括弧を含む式、複数の演算子）はサポート対象外
- 科学計算や三角関数などの高度な数学関数はサポート対象外
- 計算履歴の保存機能は含まれない
- 対話式（インタラクティブ）モードは含まれない
- 外部ライブラリへの依存は最小限とする（テスト用ライブラリは除く）

## スコープ外

以下の機能は本機能の対象外とする：
- 複数演算子を含む数式の計算
- 括弧を使った演算順序の制御  
- 変数の保存と再利用
- 計算履歴の保存・呼び出し
- グラフィカルユーザーインターフェース
- 設定ファイルによるカスタマイズ
- ネットワーク機能やAPI連携
